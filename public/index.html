<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trash Bot Deployer</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #0c141a, #1a2b3c, #0d2335);
  color: #e0f7fa;
  text-align: center;
  padding: 16px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 20px;
  line-height: 1.5;
}
.container { width: 100%; max-width: 420px; margin: 0 auto; position: relative; }
h1 {
  font-size: 1.8rem;
  font-weight: 700;
  margin: 24px 0 16px;
  background: linear-gradient(90deg, #00e6cc, #00b3ff, #00e6cc);
  background-size: 200% 200%;
  animation: gradientShift 4s ease-in-out infinite alternate;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
@keyframes gradientShift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
.card {
  background: rgba(10, 25, 35, 0.6);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4),
              inset 0 0 0 1px rgba(0, 200, 255, 0.1);
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
input, button {
  padding: 14px 16px;
  border-radius: 12px;
  border: 2px solid rgba(0, 200, 255, 0.25);
  width: 100%;
  font-size: 16px;
  background: rgba(10, 25, 47, 0.7);
  color: #e0f7fa;
  transition: all 0.3s ease;
  outline: none;
  font-family: inherit;
}
button {
  background: linear-gradient(90deg, #00e6cc, #00b3ff);
  color: #0a1929;
  font-weight: 600;
  cursor: pointer;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 12px rgba(0, 180, 255, 0.3);
  transition: all 0.3s ease;
}
button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0, 180, 255, 0.5); }
#logs {
  margin-top: 8px;
  padding: 16px;
  border-radius: 12px;
  background: rgba(5, 18, 30, 0.7);
  width: 100%;
  min-height: 240px;
  max-height: 320px;
  overflow: auto;
  font-size: 0.95rem;
  text-align: left;
  white-space: pre-wrap;
  font-family: "Fira Code", monospace;
  color: #c3e8ef;
  border: 1px solid rgba(0, 200, 255, 0.1);
  box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
}
.log-error { color: #ff5555; font-weight: 600; }
.log-warning { color: #ffa500; font-weight: 600; }
#deployedBotsContainer { margin-top: 16px; display:flex; flex-direction:column; gap:12px; width:100%; }
.bot-card {
  background: rgba(5,18,30,0.8);
  border-radius: 12px;
  padding: 12px;
  font-size: 0.95rem;
  text-align: left;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  border: 1px solid rgba(0, 200, 255, 0.1);
}
.bot-card strong { color: #00e6cc; }
.bot-card a { color:#00b3ff; text-decoration:none; font-weight:600; }
.bot-card a:hover { color:#00e6cc; }
</style>
</head>
<body>
<div class="container">
  <h1>üöÄ Trash Bot Deployer</h1>
  <div class="card">
    <input type="text" id="username" placeholder="GitHub Username" required>
    <button type="button" id="verifyBtn">üîç Verify Username</button>
    <input type="text" id="appName" placeholder="App Name (unique)" required>
    <input type="text" id="sessionId" placeholder="Session ID / Auth Key" required>
    <button id="deployBtn">‚ö° Deploy Bot</button>
  </div>
  <pre id="logs">Logs will appear here...</pre>
  <div id="deployedBotsContainer"></div>
</div>

<script>
const API_URL = "https://render-deploy-7mol.onrender.com";
const REPO_OWNER = "Tennor-modz";
const REPO_NAME = "trashcore-ultra";
let deploymentLogs = "";

function saveDeployedBot(bot) {
  let bots = JSON.parse(localStorage.getItem("deployedBots") || "[]");
  bots.push(bot);
  localStorage.setItem("deployedBots", JSON.stringify(bots));
}

function loadDeployedBots() {
  const bots = JSON.parse(localStorage.getItem("deployedBots") || "[]");
  const container = document.getElementById("deployedBotsContainer");
  container.innerHTML = "";
  bots.forEach(bot => {
    const card = document.createElement("div");
    card.className = "bot-card";
    card.innerHTML = `
      <strong>App Name:</strong> ${bot.name}<br>
      <strong>Status:</strong> üü¢ Active<br>
      <strong>Uptime:</strong> ${bot.uptime}<br>
      <strong>Date:</strong> ${bot.date}<br>
      <strong>Link:</strong> <a href="${bot.url}" target="_blank">${bot.url}</a>
    `;
    container.appendChild(card);
  });
}

// Load bots when page opens
loadDeployedBots();

async function checkFork(username) {
  if(username === REPO_OWNER) return true;
  try {
    const res = await fetch(`https://api.github.com/repos/${username}/${REPO_NAME}`);
    return res.ok;
  } catch { return false; }
}

document.getElementById("verifyBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const logsEl = document.getElementById("logs");
  if(!username) return logsEl.textContent = "‚ö†Ô∏è Enter GitHub username first.";
  logsEl.textContent = "‚è≥ Verifying fork...";
  const hasFork = await checkFork(username);
  logsEl.textContent = hasFork ? "‚úÖ Verified! You can now deploy." : "‚ùå Fork required.";
});

document.getElementById("deployBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const appName = document.getElementById("appName").value.trim();
  const sessionId = document.getElementById("sessionId").value.trim();
  const logsEl = document.getElementById("logs");
  const container = document.getElementById("deployedBotsContainer");

  if(!username || !appName || !sessionId) return logsEl.textContent = "‚ö†Ô∏è Fill all fields.";

  logsEl.textContent = "‚úÖ Verified. Starting deployment...\n";
  const tarballUrl = `https://github.com/${username}/${REPO_NAME}/archive/refs/heads/main.tar.gz`;
  const url = `${API_URL}/deploy/${appName}/logs?repo=${encodeURIComponent(tarballUrl)}&sessionId=${encodeURIComponent(sessionId)}`;
  const evtSource = new EventSource(url);

  evtSource.onmessage = (event) => {
    logsEl.textContent += event.data + "\n";
    logsEl.scrollTop = logsEl.scrollHeight;

    if (event.data.includes("Deployment succeeded")) {
      const botInfo = {
        name: appName,
        url: `https://${appName}.herokuapp.com`,
        uptime: "00h 00m (just deployed)",
        date: new Date().toLocaleString()
      };

      // Display immediately
      const card = document.createElement("div");
      card.className = "bot-card";
      card.innerHTML = `
        <strong>App Name:</strong> ${botInfo.name}<br>
        <strong>Status:</strong> üü¢ Active<br>
        <strong>Uptime:</strong> ${botInfo.uptime}<br>
        <strong>Date:</strong> ${botInfo.date}<br>
        <strong>Link:</strong> <a href="${botInfo.url}" target="_blank">${botInfo.url}</a>
      `;
      container.appendChild(card);

      // Save in localStorage
      saveDeployedBot(botInfo);

      evtSource.close();
    }
  };

  evtSource.onerror = () => {
    logsEl.textContent += "‚ö†Ô∏è Deployment connection closed.\n";
    evtSource.close();
  };
});
</script>
</body>
</html>
